<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="action_report_broiler_flock" model="ir.actions.report">
        <field name="name">Reporte de Lote Broiler</field>
        <field name="model">broiler.flock</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">broiler_farm.report_broiler_flock</field>
        <field name="report_file">broiler_farm.report_broiler_flock</field>
        <field name="print_report_name">'Lote_%s' % object.name</field>
        <field name="binding_model_id" ref="model_broiler_flock"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="base.paperformat_us"/>
    </record>

    <template id="report_broiler_flock">
        <t t-foreach="docs" t-as="o">
            <t t-call="broiler_farm.report_broiler_flock_document"/>
        </t>
    </template>

    <template id="report_broiler_flock_document">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page" style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 13px; color: #2c3e50;">

                    <!-- ============ ENCABEZADO ============ -->
                    <div style="border-bottom: 3px solid #1a5276; padding-bottom: 10px; margin-bottom: 18px;">
                        <div class="row">
                            <div class="col-8">
                                <h2 style="color: #1a5276; font-weight: 700; margin: 0; font-size: 22px; letter-spacing: 0.5px;">
                                    REPORTE DE LOTE
                                </h2>
                                <h3 style="color: #5d6d7e; font-weight: 400; margin: 4px 0 0 0; font-size: 17px;">
                                    <span t-field="o.name"/>
                                </h3>
                            </div>
                            <div class="col-4 text-end">
                                <div t-attf-style="background-color: {{ '#27ae60' if o.state == 'active' else '#e74c3c' if o.state == 'closed' else '#7f8c8d' }}; color: white; padding: 8px 18px; border-radius: 6px; display: inline-block;">
                                    <t t-if="o.state == 'active'"><span style="font-size: 14px; font-weight: 600;">ACTIVO</span></t>
                                    <t t-elif="o.state == 'closed'"><span style="font-size: 14px; font-weight: 600;">CERRADO</span></t>
                                    <t t-else=""><span style="font-size: 14px; font-weight: 600;">BORRADOR</span></t>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============ DATOS GENERALES ============ -->
                    <div class="row" style="margin-bottom: 18px;">
                        <div class="col-6">
                            <div style="background-color: #f8f9fa; border-radius: 6px; padding: 12px 16px;">
                                <h5 style="color: #1a5276; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 0; border-bottom: 2px solid #1a5276; padding-bottom: 6px;">
                                    Datos Generales
                                </h5>
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600; width: 50%;">Fecha de Ingreso:</td>
                                        <td style="padding: 3px 0;"><span t-field="o.date_in"/></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Cantidad Inicial:</td>
                                        <td style="padding: 3px 0;"><span t-field="o.initial_qty"/> aves</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Proveedor:</td>
                                        <td style="padding: 3px 0;"><span t-if="o.supplier" t-field="o.supplier"/><span t-else="">-</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Línea/Genética:</td>
                                        <td style="padding: 3px 0;"><span t-if="o.strain" t-field="o.strain"/><span t-else="">-</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="col-6">
                            <div style="background-color: #f8f9fa; border-radius: 6px; padding: 12px 16px;">
                                <h5 style="color: #1a5276; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 0; border-bottom: 2px solid #1a5276; padding-bottom: 6px;">
                                    Ubicación
                                </h5>
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600; width: 50%;">Granja:</td>
                                        <td style="padding: 3px 0;"><span t-if="o.farm_name" t-field="o.farm_name"/><span t-else="">-</span></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Galpón:</td>
                                        <td style="padding: 3px 0;"><span t-if="o.house" t-field="o.house"/><span t-else="">-</span></td>
                                    </tr>
                                </table>
                                <h5 style="color: #1a5276; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin: 14px 0 10px 0; border-bottom: 2px solid #1a5276; padding-bottom: 6px;">
                                    Configuración de Alimento
                                </h5>
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600; width: 50%;">Alimento Inicio:</td>
                                        <td style="padding: 3px 0;"><span t-field="o.feed_starter_product_tmpl_id"/></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Stock Inicio:</td>
                                        <td style="padding: 3px 0;"><span t-field="o.starter_stock_available" t-options='{"widget": "float", "precision": 2}'/> kg</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Alimento Final:</td>
                                        <td style="padding: 3px 0;"><span t-field="o.feed_finisher_product_tmpl_id"/></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 3px 0; font-weight: 600;">Stock Final:</td>
                                        <td style="padding: 3px 0;"><span t-field="o.finisher_stock_available" t-options='{"widget": "float", "precision": 2}'/> kg</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- ============ KPIs ============ -->
                    <div style="margin-bottom: 18px;">
                        <h5 style="color: #1a5276; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 0;">
                            Indicadores Clave (KPIs)
                        </h5>
                        <div class="row">
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #eaf2f8; border-top: 3px solid #2980b9; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #2980b9;"><span t-field="o.age_days"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Edad (días)</div>
                                </div>
                            </div>
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #eaf8ea; border-top: 3px solid #27ae60; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #27ae60;"><span t-field="o.alive_qty"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Aves Vivas</div>
                                </div>
                            </div>
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #fdf2e9; border-top: 3px solid #e67e22; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #e67e22;"><span t-field="o.avg_weight_g"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Peso Prom. (g)</div>
                                </div>
                            </div>
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #f5eef8; border-top: 3px solid #8e44ad; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #8e44ad;"><span t-field="o.fcr"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">FCR</div>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 8px;">
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #fdedec; border-top: 3px solid #e74c3c; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #e74c3c;"><span t-field="o.dead_qty"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Mortalidad</div>
                                </div>
                            </div>
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #fdedec; border-top: 3px solid #c0392b; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #c0392b;"><span t-field="o.culled_qty"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Descartes</div>
                                </div>
                            </div>
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #fdedec; border-top: 3px solid #e74c3c; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #e74c3c;"><span t-esc="'%.2f' % o.mortality_pct"/>%</div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">% Bajas</div>
                                </div>
                            </div>
                            <div class="col-3" style="padding: 0 6px;">
                                <div style="background-color: #eaf2f8; border-top: 3px solid #2980b9; border-radius: 0 0 6px 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 22px; font-weight: 700; color: #2980b9;"><span t-esc="'%.2f' % o.water_total_l"/></div>
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Agua Total (L)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============ COSTOS ============ -->
                    <div style="margin-bottom: 18px;">
                        <h5 style="color: #1a5276; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 0;">
                            Costos Operativos
                        </h5>
                        <div class="row">
                            <div class="col-4" style="padding: 0 6px;">
                                <div style="background: linear-gradient(135deg, #1a5276, #2980b9); color: white; border-radius: 6px; padding: 14px 18px; text-align: center;">
                                    <div style="font-size: 11px; text-transform: uppercase; opacity: 0.85;">Costo Total</div>
                                    <div style="font-size: 24px; font-weight: 700; margin-top: 4px;">Q <span t-esc="'%.2f' % o.total_cost"/></div>
                                </div>
                            </div>
                            <div class="col-4" style="padding: 0 6px;">
                                <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border-radius: 6px; padding: 14px 18px; text-align: center;">
                                    <div style="font-size: 11px; text-transform: uppercase; opacity: 0.85;">Costo Alimento</div>
                                    <div style="font-size: 24px; font-weight: 700; margin-top: 4px;">Q <span t-esc="'%.2f' % o.cost_feed"/></div>
                                </div>
                            </div>
                            <div class="col-4" style="padding: 0 6px;">
                                <div style="background: linear-gradient(135deg, #e67e22, #f39c12); color: white; border-radius: 6px; padding: 14px 18px; text-align: center;">
                                    <div style="font-size: 11px; text-transform: uppercase; opacity: 0.85;">Otros Costos</div>
                                    <div style="font-size: 24px; font-weight: 700; margin-top: 4px;">Q <span t-esc="'%.2f' % o.cost_other"/></div>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top: 8px;">
                            <div class="col-4" style="padding: 0 6px;">
                                <div style="background-color: #f8f9fa; border-radius: 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Alimento Acumulado</div>
                                    <div style="font-size: 18px; font-weight: 700; color: #2c3e50;"><span t-esc="'%.2f' % o.feed_total_kg"/> kg</div>
                                </div>
                            </div>
                            <div class="col-4" style="padding: 0 6px;">
                                <div style="background-color: #f8f9fa; border-radius: 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Costo / Ave Viva</div>
                                    <div style="font-size: 18px; font-weight: 700; color: #2c3e50;">
                                        Q <span t-esc="'%.2f' % (o.total_cost / o.alive_qty if o.alive_qty else 0)"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4" style="padding: 0 6px;">
                                <div style="background-color: #f8f9fa; border-radius: 6px; padding: 10px 14px; text-align: center;">
                                    <div style="font-size: 11px; color: #5d6d7e; text-transform: uppercase;">Costo / kg Alimento</div>
                                    <div style="font-size: 18px; font-weight: 700; color: #2c3e50;">
                                        Q <span t-esc="'%.2f' % (o.cost_feed / o.feed_total_kg if o.feed_total_kg else 0)"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============ REGISTROS DIARIOS ============ -->
                    <div style="margin-bottom: 18px;">
                        <h5 style="color: #1a5276; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin: 0 0 10px 0;">
                            Registros Diarios
                        </h5>
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                            <thead>
                                <tr style="background-color: #1a5276; color: white;">
                                    <th style="padding: 7px 6px; text-align: center; border-radius: 4px 0 0 0;">Fecha</th>
                                    <th style="padding: 7px 6px; text-align: left;">Alimento Inicio</th>
                                    <th style="padding: 7px 6px; text-align: right;">Inicio (kg)</th>
                                    <th style="padding: 7px 6px; text-align: left;">Alimento Final</th>
                                    <th style="padding: 7px 6px; text-align: right;">Final (kg)</th>
                                    <th style="padding: 7px 6px; text-align: right;">Total (kg)</th>
                                    <th style="padding: 7px 6px; text-align: right;">Agua (L)</th>
                                    <th style="padding: 7px 6px; text-align: center;">Mort.</th>
                                    <th style="padding: 7px 6px; text-align: center; border-radius: 0 4px 0 0;">Desc.</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="idx" t-value="0"/>
                                <t t-foreach="o.daily_log_ids.sorted('date')" t-as="log">
                                    <t t-set="idx" t-value="idx + 1"/>
                                    <tr t-attf-style="background-color: {{ '#ffffff' if idx % 2 == 1 else '#f4f6f7' }}; border-bottom: 1px solid #e5e8e8;">
                                        <td style="padding: 6px; text-align: center;">
                                            <span t-field="log.date" t-options='{"widget": "date"}'/>
                                        </td>
                                        <td style="padding: 6px; text-align: left;">
                                            <span t-if="log.feed_starter_product_tmpl_id" t-field="log.feed_starter_product_tmpl_id"/>
                                            <span t-else="" style="color: #bdc3c7;">-</span>
                                        </td>
                                        <td style="padding: 6px; text-align: right; font-weight: 500;">
                                            <t t-if="log.feed_starter_kg > 0">
                                                <span t-esc="'%.2f' % log.feed_starter_kg"/>
                                            </t>
                                            <t t-else=""><span style="color: #bdc3c7;">-</span></t>
                                        </td>
                                        <td style="padding: 6px; text-align: left;">
                                            <span t-if="log.feed_finisher_product_tmpl_id" t-field="log.feed_finisher_product_tmpl_id"/>
                                            <span t-else="" style="color: #bdc3c7;">-</span>
                                        </td>
                                        <td style="padding: 6px; text-align: right; font-weight: 500;">
                                            <t t-if="log.feed_finisher_kg > 0">
                                                <span t-esc="'%.2f' % log.feed_finisher_kg"/>
                                            </t>
                                            <t t-else=""><span style="color: #bdc3c7;">-</span></t>
                                        </td>
                                        <td style="padding: 6px; text-align: right; font-weight: 600;">
                                            <span t-esc="'%.2f' % log.feed_kg"/>
                                        </td>
                                        <td style="padding: 6px; text-align: right;">
                                            <t t-if="log.water_l > 0">
                                                <span t-esc="'%.2f' % log.water_l"/>
                                            </t>
                                            <t t-else=""><span style="color: #bdc3c7;">-</span></t>
                                        </td>
                                        <td style="padding: 6px; text-align: center;">
                                            <t t-if="log.dead_qty > 0">
                                                <span style="color: #e74c3c; font-weight: 600;" t-esc="log.dead_qty"/>
                                            </t>
                                            <t t-else=""><span style="color: #bdc3c7;">0</span></t>
                                        </td>
                                        <td style="padding: 6px; text-align: center;">
                                            <t t-if="log.culled_qty > 0">
                                                <span style="color: #e67e22; font-weight: 600;" t-esc="log.culled_qty"/>
                                            </t>
                                            <t t-else=""><span style="color: #bdc3c7;">0</span></t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr style="border-top: 2px solid #1a5276; font-weight: 700; background-color: #eaf2f8;">
                                    <td style="padding: 7px 6px; text-align: center;">TOTALES</td>
                                    <td style="padding: 7px 6px;"></td>
                                    <td style="padding: 7px 6px; text-align: right;">
                                        <span t-esc="'%.2f' % sum(o.daily_log_ids.mapped('feed_starter_kg'))"/>
                                    </td>
                                    <td style="padding: 7px 6px;"></td>
                                    <td style="padding: 7px 6px; text-align: right;">
                                        <span t-esc="'%.2f' % sum(o.daily_log_ids.mapped('feed_finisher_kg'))"/>
                                    </td>
                                    <td style="padding: 7px 6px; text-align: right;">
                                        <span t-esc="'%.2f' % sum(o.daily_log_ids.mapped('feed_kg'))"/>
                                    </td>
                                    <td style="padding: 7px 6px; text-align: right;">
                                        <span t-esc="'%.2f' % sum(o.daily_log_ids.mapped('water_l'))"/>
                                    </td>
                                    <td style="padding: 7px 6px; text-align: center; color: #e74c3c;">
                                        <span t-esc="sum(o.daily_log_ids.mapped('dead_qty'))"/>
                                    </td>
                                    <td style="padding: 7px 6px; text-align: center; color: #e67e22;">
                                        <span t-esc="sum(o.daily_log_ids.mapped('culled_qty'))"/>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- ============ FIRMAS ============ -->
                    <div class="row" style="margin-top: 40px;">
                        <div class="col-4 text-center">
                            <div style="border-top: 1px solid #2c3e50; margin-top: 60px; padding-top: 8px;">
                                <strong style="font-size: 12px; color: #2c3e50;">Elaborado por</strong>
                            </div>
                        </div>
                        <div class="col-4 text-center">
                            <div style="border-top: 1px solid #2c3e50; margin-top: 60px; padding-top: 8px;">
                                <strong style="font-size: 12px; color: #2c3e50;">Revisado por</strong>
                            </div>
                        </div>
                        <div class="col-4 text-center">
                            <div style="border-top: 1px solid #2c3e50; margin-top: 60px; padding-top: 8px;">
                                <strong style="font-size: 12px; color: #2c3e50;">Autorizado por</strong>
                            </div>
                        </div>
                    </div>

                </div>
            </t>
        </t>
    </template>

</odoo>
